---
title: "Capstone"
author: "Amber Crozier"
date: "2024-11-06"
output: html_document
---

```{r AC: loading packages, echo=TRUE}
library(dplyr)
library(ggplot2)
library(tidymodels)
library(readxl)
library(corrplot)
library(gtsummary)
library(yardstick)
library(gt)
library(glmnet)
library(writexl)
library(leaps)
library(openxlsx)

data <- read_excel("~/GitHub/DSE6311/AI_Retail.xlsx")
```


```{r cleaning and feature engineering, echo=TRUE}
# AC: Rename the column from AI_Satisfication to AI_Satisfaction
data <- data %>%
  rename(AI_Satisfaction = AI_Satisfication)

# AC: Rename the column from AI_Tools_Used_Voice&Photo_Search to AI_Tools_Used_Voice_Photo
data <- data %>%
  rename(AI_Tools_Used_Voice_Photo = `AI_Tools_Used_Voice&Photo_Search`)

data <- data %>%
  mutate(Education = recode(Education, 
                            "Mastersâ€™ Degree" = "Master's Degree"))


# AC: Convert AI_Satisfaction to "yes" and "no" values
data <- data %>%
  mutate(AI_Satisfaction = ifelse(AI_Satisfaction == "Satisfied", "yes", "no"))
data <- data %>%
  rename(
    AI_Tools_Used_Chatbots = `AI_Tools_Used _Chatbots`)

# AC: Define binary columns that need conversion
binary_columns <- c("Online_Consumer", "Payment_Method_Credit/Debit", "Living_Region", 
                    "Online_Service_Preference", "AI_Endorsement", "AI_Privacy_No_Trust", 
                    "AI_Enhance_Experience", "AI_Satisfaction", "AI_Tools_Used_Chatbots", 
                    "AI_Tools_Used_Virtual_Assistant", "AI_Tools_Used_Voice_Photo", 
                    "Payment_Method_COD", "Payment_Method_Ewallet", "Product_Category_Appliances", 
                    "Product_Category_Electronics", "Product_Category_Groceries", 
                    "Product_Category_Personal_Care", "Product_Category_Clothing")


# AC: Convert "no" to 0 and "yes" to 1 in all binary columns
data <- data %>%
  mutate_at(vars(binary_columns), ~ ifelse(tolower(.) == "yes", 1, ifelse(tolower(.) == "no", 0, .)))

# AC: Data Cleaning and Filtering
data <- data %>%
  filter(Online_Consumer == 1, Gender != "Prefer not to say")

data <- data %>%
  select(-Online_Consumer)

# AC: Invert the values of AI_Privacy_No_Trust (0 becomes 1, 1 becomes 0)
data <- data %>%
  mutate(AI_Privacy_No_Trust = ifelse(AI_Privacy_No_Trust == 0, 1, 0))
data <- data %>%
  rename(AI_Privacy_Trust = AI_Privacy_No_Trust)

# AC: Feature Engineering
data <- data %>%
  mutate(
    AI_Privacy_Trust = as.numeric(AI_Privacy_Trust),  
    AI_Endorsement = as.numeric(AI_Endorsement),      
    AI_Trust = (AI_Privacy_Trust + 1 + AI_Endorsement + 1) / 2,  
    AI_Trust = case_when(
      AI_Trust == 1 ~ "Low",        
      AI_Trust == 1.5 ~ "Moderate", 
      AI_Trust == 2 ~ "High"        
    )
  )

data <- data %>%
  select(-AI_Privacy_Trust, -AI_Endorsement)

# AC: Calculate AI_Usage as the sum of the 3 tools used
data <- data %>% 
  mutate(
    AI_Tools_Used_Chatbots = as.numeric(AI_Tools_Used_Chatbots),  
    AI_Tools_Used_Virtual_Assistant = as.numeric(AI_Tools_Used_Virtual_Assistant),  
    AI_Tools_Used_Voice_Photo = as.numeric(AI_Tools_Used_Voice_Photo),  
    AI_Usage_Score = (AI_Tools_Used_Chatbots + AI_Tools_Used_Virtual_Assistant + AI_Tools_Used_Voice_Photo)
  )

# AC: Categorize AI_Usage based on the sum of tools used
data <- data %>%
  mutate(AI_Usage = case_when(
    AI_Usage_Score == 1 ~ "low",   # One tool used
    AI_Usage_Score == 2 ~ "moderate",   # Two tools used
    AI_Usage_Score == 3 ~ "high"  # All three tools used
  )) %>%
  select(-AI_Usage_Score)

# AC: Convert all 0s to "NO" and 1s to "YES" across the entire dataset
data <- data %>%
  mutate_all(~ ifelse(. == 0, "NO", ifelse(. == 1, "YES", .)))

# AC: Convert NA values in AI_Usage to "none" 
data <- data %>%
  mutate(AI_Usage = ifelse(is.na(AI_Usage), "none", AI_Usage))

# AC: Rename Payment_Method_Credit/Debit to remove /
data <- data %>%
  rename(Payment_Method_Credit_Debit = `Payment_Method_Credit/Debit`)
```


```{r summary statistics, echo=TRUE}
# AC: Loop over the names of categorical columns (excluding the outcome variable)
categorical_vars <- c("Country", "Payment_Method_Credit_Debit", "Online_Service_Preference",
                      "AI_Enhance_Experience", "Payment_Method_COD", "Payment_Method_Ewallet", 
                      "Product_Category_Appliances", "Product_Category_Electronics", 
                      "Product_Category_Groceries", "Product_Category_Personal_Care", 
                      "Product_Category_Clothing", "Age", "Living_Region", "Gender", 
                      "Education", "AI_Usage", "AI_Trust", "AI_Tools_Used_Chatbots", 
                      "AI_Tools_Used_Voice_Photo", "AI_Tools_Used_Virtual_Assistant")

freq_vars <- c("Country", "Age", "Living_Region", "Gender", "Education", "AI_Usage", "AI_Trust")


# AC: Define the order for the Education, Age, Annual_Salary, AI_Usage, and AI_Trust groups
data$Education <- factor(data$Education, 
                         levels = c("Highschool Graduate", "University Graduate", "Master's Degree", 
                                    "Doctorate Degree"))
data <- data %>%
  mutate(Age = factor(Age, levels = c("Gen Z", "Millennials", "Gen X", "Baby Boomers")))

data$Annual_Salary <- factor(data$Annual_Salary, 
                         levels = c("Low", "Medium", "Medium High", "High"))

data$AI_Usage <- factor(data$AI_Usage, 
                         levels = c("none", "low", "moderate", "high"))

data$AI_Trust <- factor(data$AI_Trust, 
                         levels = c("Low", "Moderate", "High"))

# AC: Stacked bar chart for Education by AI_Satisfaction
ggplot(data, aes(x = Education, fill = AI_Satisfaction)) +
  geom_bar(position = "fill") +
  labs(title = "AI Satisfaction by Education", y = "Proportion", x = "Education") +
  scale_fill_manual(values = c("YES" = "#4A4E69", "NO" = "#F28482")) +
  theme_minimal()

# AC: Stacked bar chart for Annual_Salary by AI_Satisfaction
ggplot(data, aes(x = Annual_Salary, fill = AI_Satisfaction)) +
  geom_bar(position = "fill") +
  labs(title = "AI Satisfaction by Annual Salary", y = "Proportion", x = "Annual Salary") +
  scale_fill_manual(values = c("YES" = "#4A4E69", "NO" = "#F28482")) +
  theme_minimal()

# AC: Stacked bar chart for Age by AI_Satisfaction
ggplot(data, aes(x = Age, fill = AI_Satisfaction)) +
  geom_bar(position = "fill") +
  labs(title = "AI Satisfaction by Age", y = "Proportion", x = "Age") +
  scale_fill_manual(values = c("YES" = "#4A4E69", "NO" = "#F28482")) +
  theme_minimal()


# AC: Stacked bar chart for Country by AI_Satisfaction
ggplot(data, aes(x = Country, fill = AI_Satisfaction)) +
  geom_bar(position = "fill") +
  labs(title = "AI Satisfaction by Country", y = "Proportion", x = "Country") +
  scale_fill_manual(values = c("YES" = "#4A4E69", "NO" = "#F28482")) +
  theme_minimal()


# AC: Loop through and create bar plots
for (var in categorical_vars) {
  print(
    ggplot(data, aes_string(x = var, fill = "AI_Satisfaction")) +
      geom_bar(position = "dodge") +
      labs(title = paste("Distribution of", var, "by AI Satisfaction"),
           x = var, y = "Count") +
      theme_minimal() +
      scale_fill_manual(values = c("YES" = "#4A4E69", "NO" = "#F28482"))  
  )
}

for (var in categorical_vars) {
  print(
    ggplot(data, aes_string(x = var, fill = "AI_Satisfaction")) +
      geom_bar(position = "fill") +
      labs(title = paste("Proportion of AI Satisfaction by", var),
           x = var, y = "Proportion") +
      theme_minimal() +
      scale_fill_manual(values = c("YES" = "#4A4E69", "NO" = "#F28482"))
  )
}


# AC: Separate data by country
data_country_canada <- data %>% filter(Country == "CANADA")
data_country_china <- data %>% filter(Country == "CHINA")
data_country_india <- data %>% filter(Country == "INDIA")

# AC: Variables to exclude for demographic summaries
demographic_variables <- c("Country", "AI_Usage", "AI_Trust", "AI_Tools_Used_Chatbots",
                           "AI_Tools_Used_Voice_Photo", "AI_Tools_Used_Virtual_Assistant",
                           "Payment_Method_Credit_Debit", "Online_Service_Preference", "AI_Enhance_Experience",
                           "Payment_Method_COD", "Payment_Method_Ewallet", "Product_Category_Appliances", 
                           "Product_Category_Electronics", "Product_Category_Groceries", 
                           "Product_Category_Personal_Care", "Product_Category_Clothing")

# AC: Variables to exclude for AI Use summaries
ai_use_variables <- c("Country","Age", "Annual_Salary", "Gender", "Education", "Living_Region",
                      "Payment_Method_Credit_Debit", "Online_Service_Preference", "AI_Enhance_Experience",
                      "Payment_Method_COD", "Payment_Method_Ewallet", "Product_Category_Appliances", 
                      "Product_Category_Electronics", "Product_Category_Groceries",
                      "Product_Category_Personal_Care", "Product_Category_Clothing")

# AC: Create a stratified summary table of demographic variables by AI_Satisfaction
data_summary <- data %>%
  select(-c(demographic_variables)) %>%  
  tbl_summary(
    by = AI_Satisfaction,    # Stratifying by AI_Satisfaction
    statistic = list(all_categorical() ~ "{n} ({p}%)",  
                     all_continuous() ~ "{mean} ({sd})"), 
    digits = all_continuous() ~ 2  
  ) %>%
  add_p()

data_summary %>%
  as_gt() %>%
  tab_header(
    title = "Demographic Statistics"
  )

# AC: Create a stratified summary table of AI Use variables by AI_Satisfaction
data_summary_ai_use <- data %>%
  select(-c(ai_use_variables)) %>%  # 
  tbl_summary(
    by = AI_Satisfaction,    # Stratifying by AI_Satisfaction
    statistic = list(all_categorical() ~ "{n} ({p}%)",  
                     all_continuous() ~ "{mean} ({sd})"), 
    digits = all_continuous() ~ 2  
  ) %>%
  add_p()

data_summary_ai_use %>%
  as_gt() %>%
  tab_header(
    title = "AI Use Statistics"
  )

# AC: Create a stratified summary table of demographic variables by AI_Satisfaction/Canada
canada_summary_dems <- data_country_canada %>%
  select(-c(demographic_variables)) %>%  
  tbl_summary(
    by = AI_Satisfaction,    # Stratifying by AI_Satisfaction
    statistic = list(all_categorical() ~ "{n} ({p}%)",  
                     all_continuous() ~ "{mean} ({sd})"), 
    digits = all_continuous() ~ 2  
  ) %>%
  add_p()

canada_summary_dems %>%
  as_gt() %>%
  tab_header(
    title = "Demographic Statistics for Canada"
  )

# AC: Create a stratified summary table of demographic variables by AI_Satisfaction/Canada
canada_summary_ai_use <- data_country_canada %>%
  select(-c(ai_use_variables)) %>%  # 
  tbl_summary(
    by = AI_Satisfaction,    # Stratifying by AI_Satisfaction
    statistic = list(all_categorical() ~ "{n} ({p}%)",  
                     all_continuous() ~ "{mean} ({sd})"), 
    digits = all_continuous() ~ 2  
  ) %>%
  add_p()


canada_summary_ai_use %>%
  as_gt() %>%
  tab_header(
    title = "AI Use Statistics for Canada"
  )

# AC: Create a stratified summary table of demographic variables by AI_Satisfaction/China
china_summary_dems <- data_country_china %>%
  select(-c(demographic_variables)) %>%  
  tbl_summary(
    by = AI_Satisfaction,    # Stratifying by AI_Satisfaction
    statistic = list(all_categorical() ~ "{n} ({p}%)",  
                     all_continuous() ~ "{mean} ({sd})"), 
    digits = all_continuous() ~ 2  
  ) %>%
  add_p()

china_summary_dems %>%
  as_gt() %>%
  tab_header(
    title = "Demographic Statistics for China"
  )

# AC: Create a stratified summary table of demographic variables by AI_Satisfaction/China
china_summary_ai_use <- data_country_china %>%
  select(-c(ai_use_variables)) %>%  # 
  tbl_summary(
    by = AI_Satisfaction,    # Stratifying by AI_Satisfaction
    statistic = list(all_categorical() ~ "{n} ({p}%)",  
                     all_continuous() ~ "{mean} ({sd})"), 
    digits = all_continuous() ~ 2  
  ) %>%
  add_p()


china_summary_ai_use %>%
  as_gt() %>%
  tab_header(
    title = "AI Use Statistics for China"
  )

# AC: Create a stratified summary table of demographic variables by AI_Satisfaction/India
india_summary_dems <- data_country_india %>%
  select(-c(demographic_variables)) %>%  
  tbl_summary(
    by = AI_Satisfaction,    # Stratifying by AI_Satisfaction
    statistic = list(all_categorical() ~ "{n} ({p}%)",  
                     all_continuous() ~ "{mean} ({sd})"), 
    digits = all_continuous() ~ 2 
  ) %>%
  add_p()

india_summary_dems %>%
  as_gt() %>%
  tab_header(
    title = "Demographic Statistics for India"
  )

# AC: Create a stratified summary table of demographic variables by AI_Satisfaction/India
india_summary_ai_use <- data_country_india %>%
  select(-c(ai_use_variables)) %>%  # 
  tbl_summary(
    by = AI_Satisfaction,    # Stratifying by AI_Satisfaction
    statistic = list(all_categorical() ~ "{n} ({p}%)",  
                     all_continuous() ~ "{mean} ({sd})"), 
    digits = all_continuous() ~ 2  
  ) %>%
  add_p()


india_summary_ai_use %>%
  as_gt() %>%
  tab_header(
    title = "AI Use Statistics for India"
  )
```








